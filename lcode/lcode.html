<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŠæˆ²ç¨‹å¼æ’°å¯«æ•™å­¸ - å„ç‚ºã€Œä¿ä¿ã€ï¼Œä¸Šè»Šå›‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #2e3933 0%, #689dc5 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.8;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 3px solid #689dc5;
        }

        h1 {
            font-size: 42px;
            color: #2e3933;
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .nav-btn {
            background: #689dc5;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: #2e3933;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(104, 157, 197, 0.4);
        }

        .toc {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 40px;
        }

        .toc h2 {
            color: #2e3933;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
        }

        .toc li::before {
            content: 'â–¸';
            position: absolute;
            left: 0;
            color: #689dc5;
            font-weight: bold;
        }

        .toc a {
            color: #2e3933;
            text-decoration: none;
            font-size: 16px;
            transition: color 0.3s;
        }

        .toc a:hover {
            color: #689dc5;
        }

        .section {
            margin-bottom: 60px;
        }

        .section h2 {
            color: #2e3933;
            font-size: 32px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #689dc5;
        }

        .section h3 {
            color: #689dc5;
            font-size: 24px;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .section h4 {
            color: #c34e17;
            font-size: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .section p {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .code-block {
            background: #2e3933;
            color: #a0c5db;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            overflow-x: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .code-block pre {
            margin: 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .code-comment {
            color: #83a598;
        }

        .code-keyword {
            color: #fb4934;
        }

        .code-function {
            color: #b8bb26;
        }

        .code-string {
            color: #fabd2f;
        }

        .code-number {
            color: #d3869b;
        }

        .highlight-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .highlight-box h4 {
            color: #856404;
            margin-top: 0;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 5px solid #0c5460;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box h4 {
            color: #0c5460;
            margin-top: 0;
        }

        .demo-box {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
        }

        .demo-box h4 {
            color: #2e7d32;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .visual-diagram {
            background: white;
            border: 2px solid #689dc5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .visual-diagram canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .step-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }

        .step-list li {
            counter-increment: step-counter;
            margin-bottom: 25px;
            padding-left: 50px;
            position: relative;
        }

        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #689dc5;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            border-color: #689dc5;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(104, 157, 197, 0.3);
        }

        .feature-card h4 {
            color: #2e3933;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .feature-card p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #ddd;
            text-align: center;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 32px;
            }

            .section h2 {
                font-size: 26px;
            }

            .section h3 {
                font-size: 20px;
            }

            .code-block {
                padding: 15px;
            }

            .code-block pre {
                font-size: 12px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ® éŠæˆ²ç¨‹å¼æ’°å¯«æ•™å­¸</h1>
            <p class="subtitle">å¾é›¶é–‹å§‹æ‰“é€ ã€Œå„ç‚ºä¿ä¿ï¼Œä¸Šè»Šå›‰ã€éŠæˆ²</p>
            <div class="nav-buttons">
                <a href="../index.html" class="nav-btn">å›åˆ°é¦–é </a>
                <a href="../game1/game1.html" class="nav-btn">è©¦ç©éŠæˆ²</a>
            </div>
        </header>

        <!-- ç›®éŒ„ -->
        <nav class="toc">
            <h2>ğŸ“š æ•™å­¸ç›®éŒ„</h2>
            <ul>
                <li><a href="#section1">1. åŸºç¤è¨­å®šèˆ‡ç•«å¸ƒ</a></li>
                <li><a href="#section2">2. ç¢°æ’æª¢æ¸¬ç³»çµ±ï¼ˆé‚Šç·£è­˜åˆ¥ï¼‰</a></li>
                <li><a href="#section3">3. è§’è‰²ç§»å‹•æ§åˆ¶</a></li>
                <li><a href="#section4">4. è¨ˆæ™‚èˆ‡è¨ˆåˆ†é‚è¼¯</a></li>
                <li><a href="#section5">5. æ•µäºº AI èˆ‡è¦–ç·šç³»çµ±</a></li>
                <li><a href="#section6">6. éŠæˆ²ç‹€æ…‹ç®¡ç†</a></li>
                <li><a href="#section7">7. å®Œæ•´éŠæˆ²å¾ªç’°</a></li>
            </ul>
        </nav>

        <!-- ç¬¬ä¸€ç« ï¼šåŸºç¤è¨­å®šèˆ‡ç•«å¸ƒ -->
        <section class="section" id="section1">
            <h2>1. åŸºç¤è¨­å®šèˆ‡ç•«å¸ƒ</h2>

            <p>åœ¨é–‹å§‹æ’°å¯«éŠæˆ²ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å…ˆå»ºç«‹åŸºæœ¬çš„éŠæˆ²é…ç½®èˆ‡ Canvas ç•«å¸ƒã€‚</p>

            <h3>æ­¥é©Ÿ 1ï¼šå»ºç«‹éŠæˆ²é…ç½®</h3>
            <p>é¦–å…ˆï¼Œæˆ‘å€‘å®šç¾©éŠæˆ²çš„åŸºæœ¬åƒæ•¸ï¼Œä¾‹å¦‚ç•«å¸ƒå¤§å°ã€è§’è‰²é€Ÿåº¦ã€é¡è‰²ç­‰ã€‚ä½¿ç”¨ç‰©ä»¶é›†ä¸­ç®¡ç†é€™äº›è¨­å®šï¼Œæ–¹ä¾¿æ—¥å¾Œèª¿æ•´ã€‚</p>

            <div class="code-block">
<pre><span class="code-comment">// ==================== éŠæˆ²é…ç½® ====================</span>
<span class="code-keyword">const</span> CONFIG = {
    <span class="code-comment">// ç•«å¸ƒå°ºå¯¸</span>
    CANVAS_WIDTH: <span class="code-number">800</span>,
    CANVAS_HEIGHT: <span class="code-number">600</span>,

    <span class="code-comment">// ç©å®¶åƒæ•¸</span>
    PLAYER_RADIUS: <span class="code-number">15</span>,        <span class="code-comment">// ç©å®¶åŠå¾‘</span>
    PLAYER_SPEED: <span class="code-number">3</span>,          <span class="code-comment">// ç©å®¶ç§»å‹•é€Ÿåº¦</span>

    <span class="code-comment">// æ•µäººåƒæ•¸</span>
    ENEMY_RADIUS: <span class="code-number">15</span>,         <span class="code-comment">// æ•µäººåŠå¾‘</span>
    ENEMY_SPEED: <span class="code-number">2.5</span>,         <span class="code-comment">// æ•µäººå·¡é‚é€Ÿåº¦</span>
    ENEMY_CHASE_SPEED: <span class="code-number">4</span>,     <span class="code-comment">// æ•µäººè¿½æ“Šé€Ÿåº¦</span>
    ENEMY_VISION_RANGE: <span class="code-number">200</span>,  <span class="code-comment">// æ•µäººè¦–ç·šç¯„åœ</span>

    <span class="code-comment">// éŠæˆ²æ©Ÿåˆ¶</span>
    INITIAL_LIVES: <span class="code-number">3</span>,         <span class="code-comment">// åˆå§‹ç”Ÿå‘½å€¼</span>
    INVINCIBLE_TIME: <span class="code-number">2000</span>,    <span class="code-comment">// ç„¡æ•µæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰</span>

    <span class="code-comment">// é¡è‰²é…ç½®</span>
    PLAYER_COLOR: <span class="code-string">'#a0c5db'</span>,   <span class="code-comment">// ç©å®¶é¡è‰²ï¼ˆæ·ºè—è‰²ï¼‰</span>
    ENEMY_COLOR: <span class="code-string">'#c34e17'</span>,    <span class="code-comment">// æ•µäººé¡è‰²ï¼ˆæ©˜ç´…è‰²ï¼‰</span>
    WALL_COLOR: <span class="code-string">'#d0d4d0'</span>,     <span class="code-comment">// ç‰†å£é¡è‰²ï¼ˆç°ç™½è‰²ï¼‰</span>
    FLOOR_COLOR: <span class="code-string">'#2e3933'</span>     <span class="code-comment">// åœ°æ¿é¡è‰²ï¼ˆæ·±ç¶ è‰²ï¼‰</span>
};</pre>
            </div>

            <div class="highlight-box">
                <h4>ğŸ’¡ ç‚ºä»€éº¼è¦ä½¿ç”¨é…ç½®ç‰©ä»¶ï¼Ÿ</h4>
                <p>ä½¿ç”¨ CONFIG ç‰©ä»¶é›†ä¸­ç®¡ç†æ‰€æœ‰å¸¸æ•¸ï¼Œæœ‰ä»¥ä¸‹å„ªé»ï¼š</p>
                <ul>
                    <li>å®¹æ˜“ç¶­è­·ï¼šæ‰€æœ‰åƒæ•¸é›†ä¸­åœ¨ä¸€è™•ï¼Œä¿®æ”¹æ™‚ä¸ç”¨ç¿»éæ•´å€‹ç¨‹å¼ç¢¼</li>
                    <li>é¿å…é­”è¡“æ•¸å­—ï¼šä½¿ç”¨æœ‰æ„ç¾©çš„åç¨±ï¼Œæé«˜ç¨‹å¼ç¢¼å¯è®€æ€§</li>
                    <li>æ–¹ä¾¿èª¿æ•´å¹³è¡¡ï¼šéŠæˆ²æ¸¬è©¦æ™‚å¯å¿«é€Ÿèª¿æ•´æ•¸å€¼</li>
                </ul>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šè¨­å®š Canvas ç•«å¸ƒ</h3>
            <p>Canvas æ˜¯ HTML5 æä¾›çš„ç¹ªåœ– APIï¼Œæˆ‘å€‘ç”¨å®ƒä¾†ç¹ªè£½éŠæˆ²ç•«é¢ã€‚</p>

            <div class="code-block">
<pre><span class="code-comment">// HTML ä¸­çš„ Canvas å…ƒç´ </span>
&lt;canvas id=<span class="code-string">"gameCanvas"</span> width=<span class="code-string">"800"</span> height=<span class="code-string">"600"</span>&gt;&lt;/canvas&gt;

<span class="code-comment">// JavaScript ä¸­å–å¾— Canvas ä¸¦è¨­å®šç¹ªåœ–ç’°å¢ƒ</span>
<span class="code-keyword">class</span> <span class="code-function">Game</span> {
    <span class="code-function">constructor</span>() {
        <span class="code-comment">// å–å¾— Canvas å…ƒç´ </span>
        <span class="code-keyword">this</span>.canvas = document.<span class="code-function">getElementById</span>(<span class="code-string">'gameCanvas'</span>);

        <span class="code-comment">// å–å¾— 2D ç¹ªåœ–ç’°å¢ƒ (context)</span>
        <span class="code-keyword">this</span>.ctx = <span class="code-keyword">this</span>.canvas.<span class="code-function">getContext</span>(<span class="code-string">'2d'</span>);
    }

    <span class="code-comment">// ç¹ªè£½ç•«é¢çš„æ–¹æ³•</span>
    <span class="code-function">draw</span>() {
        <span class="code-comment">// æ¸…ç©ºç•«é¢ï¼ˆç¹ªè£½åœ°æ¿ï¼‰</span>
        <span class="code-keyword">this</span>.ctx.fillStyle = CONFIG.FLOOR_COLOR;
        <span class="code-keyword">this</span>.ctx.<span class="code-function">fillRect</span>(<span class="code-number">0</span>, <span class="code-number">0</span>, CONFIG.CANVAS_WIDTH, CONFIG.CANVAS_HEIGHT);
    }
}</pre>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šå»ºç«‹ç‰†é«”åœ°åœ–</h3>
            <p>ä½¿ç”¨é™£åˆ—å®šç¾©ç‰†é«”ä½ç½®ï¼Œå‰µé€ è¿·å®®æ•ˆæœã€‚æ¯å€‹ç‰†é«”æ˜¯ä¸€å€‹çŸ©å½¢ç‰©ä»¶ï¼ŒåŒ…å« xã€yã€widthã€heightã€‚</p>

            <div class="code-block">
<pre><span class="code-comment">// å®šç¾©ç‰†é«”é™£åˆ—</span>
<span class="code-keyword">const</span> WALLS = [
    <span class="code-comment">// å¤–ç‰†ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ï¼‰</span>
    {x: <span class="code-number">0</span>, y: <span class="code-number">0</span>, width: <span class="code-number">800</span>, height: <span class="code-number">20</span>},       <span class="code-comment">// ä¸Šç‰†</span>
    {x: <span class="code-number">0</span>, y: <span class="code-number">580</span>, width: <span class="code-number">800</span>, height: <span class="code-number">20</span>},     <span class="code-comment">// ä¸‹ç‰†</span>
    {x: <span class="code-number">0</span>, y: <span class="code-number">0</span>, width: <span class="code-number">20</span>, height: <span class="code-number">600</span>},       <span class="code-comment">// å·¦ç‰†</span>
    {x: <span class="code-number">780</span>, y: <span class="code-number">0</span>, width: <span class="code-number">20</span>, height: <span class="code-number">600</span>},     <span class="code-comment">// å³ç‰†</span>

    <span class="code-comment">// å…§éƒ¨éšœç¤™ç‰©ï¼ˆå‰µé€ è¿·å®®æ•ˆæœï¼‰</span>
    {x: <span class="code-number">100</span>, y: <span class="code-number">100</span>, width: <span class="code-number">150</span>, height: <span class="code-number">20</span>},   <span class="code-comment">// æ°´å¹³ç‰†</span>
    {x: <span class="code-number">300</span>, y: <span class="code-number">200</span>, width: <span class="code-number">20</span>, height: <span class="code-number">200</span>}    <span class="code-comment">// å‚ç›´ç‰†</span>
];

<span class="code-comment">// ç¹ªè£½æ‰€æœ‰ç‰†é«”</span>
<span class="code-function">drawWalls</span>() {
    <span class="code-keyword">this</span>.ctx.fillStyle = CONFIG.WALL_COLOR;
    <span class="code-keyword">for</span> (<span class="code-keyword">let</span> wall <span class="code-keyword">of</span> WALLS) {
        <span class="code-keyword">this</span>.ctx.<span class="code-function">fillRect</span>(wall.x, wall.y, wall.width, wall.height);
    }
}</pre>
            </div>

            <div class="demo-box">
                <h4>ğŸ¨ å‘ˆç¾ç•«é¢</h4>
                <canvas id="demo1" width="400" height="300"></canvas>
                <p style="margin-top: 15px; color: #666;">æ·±ç¶ è‰²åœ°æ¿ + ç°ç™½è‰²ç‰†é«”æ§‹æˆçš„éŠæˆ²å ´æ™¯</p>
            </div>
        </section>

        <!-- ç¬¬äºŒç« ï¼šç¢°æ’æª¢æ¸¬ç³»çµ± -->
        <section class="section" id="section2">
            <h2>2. ç¢°æ’æª¢æ¸¬ç³»çµ±ï¼ˆé‚Šç·£è­˜åˆ¥ï¼‰</h2>

            <p>ç¢°æ’æª¢æ¸¬æ˜¯éŠæˆ²ä¸­æœ€é‡è¦çš„ç³»çµ±ä¹‹ä¸€ï¼Œç”¨æ–¼åˆ¤æ–·è§’è‰²æ˜¯å¦ç¢°åˆ°ç‰†å£æˆ–å…¶ä»–ç‰©é«”ã€‚æˆ‘å€‘éœ€è¦å¯¦ä½œå…©ç¨®ç¢°æ’æª¢æ¸¬ï¼š</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>åœ“å½¢èˆ‡çŸ©å½¢ç¢°æ’</h4>
                    <p>ç”¨æ–¼åµæ¸¬ç©å®¶/æ•µäººï¼ˆåœ“å½¢ï¼‰æ˜¯å¦ç¢°åˆ°ç‰†å£ï¼ˆçŸ©å½¢ï¼‰</p>
                </div>
                <div class="feature-card">
                    <h4>åœ“å½¢èˆ‡åœ“å½¢ç¢°æ’</h4>
                    <p>ç”¨æ–¼åµæ¸¬ç©å®¶ï¼ˆåœ“å½¢ï¼‰æ˜¯å¦ç¢°åˆ°æ•µäººï¼ˆåœ“å½¢ï¼‰</p>
                </div>
            </div>

            <h3>æ­¥é©Ÿ 1ï¼šåœ“å½¢èˆ‡çŸ©å½¢ç¢°æ’æª¢æ¸¬</h3>
            <p>é€™æ˜¯æœ€å¸¸ç”¨çš„ç¢°æ’æª¢æ¸¬æ–¹æ³•ï¼Œç”¨æ–¼åµæ¸¬ç©å®¶æ˜¯å¦æ’åˆ°ç‰†å£ã€‚</p>

            <div class="info-box">
                <h4>ğŸ“ æ¼”ç®—æ³•åŸç†</h4>
                <p><strong>æ‰¾å‡ºçŸ©å½¢ä¸Šæœ€æ¥è¿‘åœ“å¿ƒçš„é»</strong>ï¼Œç„¶å¾Œè¨ˆç®—è©²é»èˆ‡åœ“å¿ƒçš„è·é›¢ï¼š</p>
                <ol class="step-list">
                    <li>æ‰¾å‡ºçŸ©å½¢ä¸Šæœ€æ¥è¿‘åœ“å¿ƒçš„ X åº§æ¨™ï¼ˆtestXï¼‰</li>
                    <li>æ‰¾å‡ºçŸ©å½¢ä¸Šæœ€æ¥è¿‘åœ“å¿ƒçš„ Y åº§æ¨™ï¼ˆtestYï¼‰</li>
                    <li>è¨ˆç®— (testX, testY) èˆ‡åœ“å¿ƒçš„è·é›¢</li>
                    <li>å¦‚æœè·é›¢ â‰¤ åœ“çš„åŠå¾‘ï¼Œå‰‡ç™¼ç”Ÿç¢°æ’</li>
                </ol>
            </div>

            <div class="code-block">
<pre><span class="code-comment">/**
 * åœ“å½¢èˆ‡çŸ©å½¢ç¢°æ’æª¢æ¸¬
 * @param {number} cx - åœ“å¿ƒ X åº§æ¨™
 * @param {number} cy - åœ“å¿ƒ Y åº§æ¨™
 * @param {number} radius - åœ“çš„åŠå¾‘
 * @param {object} rect - çŸ©å½¢ç‰©ä»¶ {x, y, width, height}
 * @returns {boolean} - æ˜¯å¦ç™¼ç”Ÿç¢°æ’
 */</span>
<span class="code-keyword">function</span> <span class="code-function">circleRectCollision</span>(cx, cy, radius, rect) {
    <span class="code-comment">// æ­¥é©Ÿ 1ï¼šæ‰¾å‡ºçŸ©å½¢ä¸Šæœ€æ¥è¿‘åœ“å¿ƒçš„ X åº§æ¨™</span>
    <span class="code-keyword">let</span> testX = cx;  <span class="code-comment">// é è¨­ç‚ºåœ“å¿ƒ X</span>

    <span class="code-keyword">if</span> (cx &lt; rect.x) {
        <span class="code-comment">// åœ“å¿ƒåœ¨çŸ©å½¢å·¦å´ï¼Œæœ€è¿‘é»æ˜¯çŸ©å½¢å·¦é‚Šç·£</span>
        testX = rect.x;
    } <span class="code-keyword">else if</span> (cx &gt; rect.x + rect.width) {
        <span class="code-comment">// åœ“å¿ƒåœ¨çŸ©å½¢å³å´ï¼Œæœ€è¿‘é»æ˜¯çŸ©å½¢å³é‚Šç·£</span>
        testX = rect.x + rect.width;
    }

    <span class="code-comment">// æ­¥é©Ÿ 2ï¼šæ‰¾å‡ºçŸ©å½¢ä¸Šæœ€æ¥è¿‘åœ“å¿ƒçš„ Y åº§æ¨™</span>
    <span class="code-keyword">let</span> testY = cy;  <span class="code-comment">// é è¨­ç‚ºåœ“å¿ƒ Y</span>

    <span class="code-keyword">if</span> (cy &lt; rect.y) {
        <span class="code-comment">// åœ“å¿ƒåœ¨çŸ©å½¢ä¸Šæ–¹ï¼Œæœ€è¿‘é»æ˜¯çŸ©å½¢ä¸Šé‚Šç·£</span>
        testY = rect.y;
    } <span class="code-keyword">else if</span> (cy &gt; rect.y + rect.height) {
        <span class="code-comment">// åœ“å¿ƒåœ¨çŸ©å½¢ä¸‹æ–¹ï¼Œæœ€è¿‘é»æ˜¯çŸ©å½¢ä¸‹é‚Šç·£</span>
        testY = rect.y + rect.height;
    }

    <span class="code-comment">// æ­¥é©Ÿ 3ï¼šè¨ˆç®—æœ€è¿‘é»èˆ‡åœ“å¿ƒçš„è·é›¢</span>
    <span class="code-keyword">const</span> distX = cx - testX;  <span class="code-comment">// X æ–¹å‘è·é›¢</span>
    <span class="code-keyword">const</span> distY = cy - testY;  <span class="code-comment">// Y æ–¹å‘è·é›¢</span>
    <span class="code-keyword">const</span> distance = Math.<span class="code-function">sqrt</span>(distX * distX + distY * distY);

    <span class="code-comment">// æ­¥é©Ÿ 4ï¼šåˆ¤æ–·æ˜¯å¦ç¢°æ’ï¼ˆè·é›¢ â‰¤ åŠå¾‘ï¼‰</span>
    <span class="code-keyword">return</span> distance &lt;= radius;
}</pre>
            </div>

            <div class="demo-box">
                <h4>ğŸ¯ ç¢°æ’æª¢æ¸¬ç¤ºæ„åœ–</h4>
                <canvas id="demo2" width="400" height="300"></canvas>
                <p style="margin-top: 15px; color: #666;">è—è‰²åœ“å½¢æ¥è¿‘ç°è‰²çŸ©å½¢æ™‚ï¼Œæœƒè§¸ç™¼ç¢°æ’æª¢æ¸¬ï¼ˆåœ“å½¢è®Šç´…ï¼‰</p>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šåœ“å½¢èˆ‡åœ“å½¢ç¢°æ’æª¢æ¸¬</h3>
            <p>ç”¨æ–¼åµæ¸¬ç©å®¶æ˜¯å¦è¢«æ•µäººæŠ“åˆ°ã€‚é€™å€‹æ¯”è¼ƒç°¡å–®ï¼Œåªéœ€è¨ˆç®—å…©å€‹åœ“å¿ƒçš„è·é›¢ã€‚</p>

            <div class="code-block">
<pre><span class="code-comment">/**
 * åœ“å½¢èˆ‡åœ“å½¢ç¢°æ’æª¢æ¸¬
 * @param {number} x1, y1 - ç¬¬ä¸€å€‹åœ“çš„åœ“å¿ƒåº§æ¨™
 * @param {number} r1 - ç¬¬ä¸€å€‹åœ“çš„åŠå¾‘
 * @param {number} x2, y2 - ç¬¬äºŒå€‹åœ“çš„åœ“å¿ƒåº§æ¨™
 * @param {number} r2 - ç¬¬äºŒå€‹åœ“çš„åŠå¾‘
 * @returns {boolean} - æ˜¯å¦ç™¼ç”Ÿç¢°æ’
 */</span>
<span class="code-keyword">function</span> <span class="code-function">circleCircleCollision</span>(x1, y1, r1, x2, y2, r2) {
    <span class="code-comment">// è¨ˆç®—å…©åœ“å¿ƒçš„è·é›¢</span>
    <span class="code-keyword">const</span> dx = x1 - x2;
    <span class="code-keyword">const</span> dy = y1 - y2;
    <span class="code-keyword">const</span> distance = Math.<span class="code-function">sqrt</span>(dx * dx + dy * dy);

    <span class="code-comment">// å¦‚æœè·é›¢ â‰¤ å…©åœ“åŠå¾‘ä¹‹å’Œï¼Œå‰‡ç™¼ç”Ÿç¢°æ’</span>
    <span class="code-keyword">return</span> distance &lt;= r1 + r2;
}</pre>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šåœ¨è§’è‰²ç§»å‹•æ™‚æ‡‰ç”¨ç¢°æ’æª¢æ¸¬</h3>
            <p>ç•¶ç©å®¶ç§»å‹•æ™‚ï¼Œæˆ‘å€‘éœ€è¦æª¢æŸ¥æ–°ä½ç½®æ˜¯å¦æœƒç¢°åˆ°ç‰†å£ï¼Œå¦‚æœæœƒç¢°æ’å°±ä¸å…è¨±ç§»å‹•ã€‚</p>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Player</span> {
    <span class="code-function">update</span>() {
        <span class="code-comment">// è¨ˆç®—æ–°ä½ç½®</span>
        <span class="code-keyword">const</span> newX = <span class="code-keyword">this</span>.x + dx * <span class="code-keyword">this</span>.speed;
        <span class="code-keyword">const</span> newY = <span class="code-keyword">this</span>.y + dy * <span class="code-keyword">this</span>.speed;

        <span class="code-comment">// X è»¸ç§»å‹•æª¢æ¸¬ï¼ˆåˆ†é–‹æª¢æ¸¬å¯ä»¥æ²¿ç‰†æ»‘å‹•ï¼‰</span>
        <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.<span class="code-function">checkCollision</span>(newX, <span class="code-keyword">this</span>.y)) {
            <span class="code-keyword">this</span>.x = newX;  <span class="code-comment">// æ²’æœ‰ç¢°æ’ï¼Œæ›´æ–°ä½ç½®</span>
        }

        <span class="code-comment">// Y è»¸ç§»å‹•æª¢æ¸¬</span>
        <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.<span class="code-function">checkCollision</span>(<span class="code-keyword">this</span>.x, newY)) {
            <span class="code-keyword">this</span>.y = newY;  <span class="code-comment">// æ²’æœ‰ç¢°æ’ï¼Œæ›´æ–°ä½ç½®</span>
        }
    }

    <span class="code-comment">// æª¢æŸ¥æŒ‡å®šä½ç½®æ˜¯å¦æœƒç¢°åˆ°ç‰†å£</span>
    <span class="code-function">checkCollision</span>(x, y) {
        <span class="code-keyword">for</span> (<span class="code-keyword">let</span> wall <span class="code-keyword">of</span> WALLS) {
            <span class="code-keyword">if</span> (<span class="code-function">circleRectCollision</span>(x, y, <span class="code-keyword">this</span>.radius, wall)) {
                <span class="code-keyword">return</span> <span class="code-keyword">true</span>;  <span class="code-comment">// ç™¼ç”Ÿç¢°æ’</span>
            }
        }
        <span class="code-keyword">return</span> <span class="code-keyword">false</span>;  <span class="code-comment">// æ²’æœ‰ç¢°æ’</span>
    }
}</pre>
            </div>

            <div class="highlight-box">
                <h4>ğŸ’¡ ç‚ºä»€éº¼è¦åˆ†é–‹æª¢æ¸¬ X å’Œ Yï¼Ÿ</h4>
                <p>åˆ†é–‹æª¢æ¸¬ X è»¸å’Œ Y è»¸çš„ç§»å‹•ï¼Œå¯ä»¥è®“è§’è‰²ã€Œæ²¿è‘—ç‰†å£æ»‘å‹•ã€ã€‚ä¾‹å¦‚ï¼š</p>
                <ul>
                    <li>ç©å®¶æ–œå‘ç§»å‹•æ’åˆ°å‚ç›´ç‰†å£æ™‚ï¼ŒX è»¸è¢«é˜»æ“‹ä½† Y è»¸å¯ä»¥ç¹¼çºŒç§»å‹•</li>
                    <li>é€™æ¨£ç©å®¶å°±èƒ½æ²¿è‘—ç‰†å£æ»‘å‹•ï¼Œè€Œä¸æ˜¯å®Œå…¨å¡ä½</li>
                    <li>æä¾›æ›´æµæš¢çš„éŠæˆ²é«”é©—</li>
                </ul>
            </div>
        </section>

        <!-- ç¬¬ä¸‰ç« ï¼šè§’è‰²ç§»å‹•æ§åˆ¶ -->
        <section class="section" id="section3">
            <h2>3. è§’è‰²ç§»å‹•æ§åˆ¶</h2>

            <p>æˆ‘å€‘çš„éŠæˆ²æ”¯æ´ä¸‰ç¨®æ§åˆ¶æ–¹å¼ï¼šéµç›¤ã€æ»‘é¼ ã€è§¸æ§ã€‚é€™è®“ç©å®¶åœ¨ä¸åŒè£ç½®ä¸Šéƒ½èƒ½æµæš¢éŠç©ã€‚</p>

            <h3>æ­¥é©Ÿ 1ï¼šéµç›¤æ§åˆ¶</h3>
            <p>ä½¿ç”¨æ–¹å‘éµæˆ– WASD éµæ§åˆ¶è§’è‰²ç§»å‹•ã€‚</p>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Player</span> {
    <span class="code-function">constructor</span>(x, y) {
        <span class="code-comment">// è¨˜éŒ„æŒ‰éµç‹€æ…‹</span>
        <span class="code-keyword">this</span>.keys = {
            up: <span class="code-keyword">false</span>,
            down: <span class="code-keyword">false</span>,
            left: <span class="code-keyword">false</span>,
            right: <span class="code-keyword">false</span>
        };
    }
}

<span class="code-comment">// ç›£è½æŒ‰éµæŒ‰ä¸‹äº‹ä»¶</span>
window.<span class="code-function">addEventListener</span>(<span class="code-string">'keydown'</span>, (e) =&gt; {
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowUp'</span> || e.key === <span class="code-string">'w'</span>) {
        player.keys.up = <span class="code-keyword">true</span>;
        e.<span class="code-function">preventDefault</span>();  <span class="code-comment">// é˜²æ­¢é é¢æ»¾å‹•</span>
    }
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowDown'</span> || e.key === <span class="code-string">'s'</span>) {
        player.keys.down = <span class="code-keyword">true</span>;
    }
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowLeft'</span> || e.key === <span class="code-string">'a'</span>) {
        player.keys.left = <span class="code-keyword">true</span>;
    }
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowRight'</span> || e.key === <span class="code-string">'d'</span>) {
        player.keys.right = <span class="code-keyword">true</span>;
    }
});

<span class="code-comment">// ç›£è½æŒ‰éµæ”¾é–‹äº‹ä»¶</span>
window.<span class="code-function">addEventListener</span>(<span class="code-string">'keyup'</span>, (e) =&gt; {
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowUp'</span> || e.key === <span class="code-string">'w'</span>) player.keys.up = <span class="code-keyword">false</span>;
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowDown'</span> || e.key === <span class="code-string">'s'</span>) player.keys.down = <span class="code-keyword">false</span>;
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowLeft'</span> || e.key === <span class="code-string">'a'</span>) player.keys.left = <span class="code-keyword">false</span>;
    <span class="code-keyword">if</span> (e.key === <span class="code-string">'ArrowRight'</span> || e.key === <span class="code-string">'d'</span>) player.keys.right = <span class="code-keyword">false</span>;
});</pre>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šæ ¹æ“šæŒ‰éµç‹€æ…‹ç§»å‹•è§’è‰²</h3>
            <p>åœ¨éŠæˆ²æ›´æ–°å¾ªç’°ä¸­ï¼Œæ ¹æ“šæŒ‰éµç‹€æ…‹è¨ˆç®—ç§»å‹•æ–¹å‘ã€‚</p>

            <div class="code-block">
<pre><span class="code-function">update</span>() {
    <span class="code-keyword">let</span> dx = <span class="code-number">0</span>;  <span class="code-comment">// X è»¸ç§»å‹•é‡</span>
    <span class="code-keyword">let</span> dy = <span class="code-number">0</span>;  <span class="code-comment">// Y è»¸ç§»å‹•é‡</span>

    <span class="code-comment">// æ ¹æ“šæŒ‰éµç‹€æ…‹è¨­å®šç§»å‹•æ–¹å‘</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.keys.up) dy -= <span class="code-number">1</span>;      <span class="code-comment">// å‘ä¸Š</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.keys.down) dy += <span class="code-number">1</span>;    <span class="code-comment">// å‘ä¸‹</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.keys.left) dx -= <span class="code-number">1</span>;    <span class="code-comment">// å‘å·¦</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.keys.right) dx += <span class="code-number">1</span>;   <span class="code-comment">// å‘å³</span>

    <span class="code-comment">// å°è§’ç·šç§»å‹•æ­£è¦åŒ–ï¼ˆé¿å…å°è§’ç·šç§»å‹•éå¿«ï¼‰</span>
    <span class="code-keyword">if</span> (dx !== <span class="code-number">0</span> && dy !== <span class="code-number">0</span>) {
        dx *= <span class="code-number">0.707</span>;  <span class="code-comment">// â‰ˆ 1/âˆš2ï¼Œä¿æŒå°è§’ç·šé€Ÿåº¦ä¸€è‡´</span>
        dy *= <span class="code-number">0.707</span>;
    }

    <span class="code-comment">// è¨ˆç®—æ–°ä½ç½®</span>
    <span class="code-keyword">const</span> newX = <span class="code-keyword">this</span>.x + dx * <span class="code-keyword">this</span>.speed;
    <span class="code-keyword">const</span> newY = <span class="code-keyword">this</span>.y + dy * <span class="code-keyword">this</span>.speed;

    <span class="code-comment">// ç¢°æ’æª¢æ¸¬å¾Œæ›´æ–°ä½ç½®ï¼ˆå¦‚å‰ä¸€ç« æ‰€è¿°ï¼‰</span>
    <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.<span class="code-function">checkCollision</span>(newX, <span class="code-keyword">this</span>.y)) <span class="code-keyword">this</span>.x = newX;
    <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.<span class="code-function">checkCollision</span>(<span class="code-keyword">this</span>.x, newY)) <span class="code-keyword">this</span>.y = newY;
}</pre>
            </div>

            <div class="info-box">
                <h4>ğŸ“ ç‚ºä»€éº¼è¦æ­£è¦åŒ–å°è§’ç·šç§»å‹•ï¼Ÿ</h4>
                <p>å‡è¨­ç©å®¶åŒæ™‚æŒ‰ä¸‹ã€Œä¸Šã€å’Œã€Œå³ã€ï¼š</p>
                <ul>
                    <li>ä¸æ­£è¦åŒ–ï¼šé€Ÿåº¦ = âˆš(1Â² + 1Â²) = 1.414 å€ï¼ˆå°è§’ç·šæ¯”å–®æ–¹å‘å¿« 41%ï¼‰</li>
                    <li>æ­£è¦åŒ–å¾Œï¼šé€Ÿåº¦ = âˆš(0.707Â² + 0.707Â²) = 1 å€ï¼ˆèˆ‡å–®æ–¹å‘é€Ÿåº¦ç›¸åŒï¼‰</li>
                    <li>ç¢ºä¿ç©å®¶åœ¨å„å€‹æ–¹å‘çš„ç§»å‹•é€Ÿåº¦ä¸€è‡´</li>
                </ul>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šæ»‘é¼ èˆ‡è§¸æ§æ§åˆ¶</h3>
            <p>è®“è§’è‰²æœå‘æ»‘é¼ /è§¸æ§ä½ç½®ç§»å‹•ï¼Œæä¾›æ›´ç›´è¦ºçš„æ“ä½œé«”é©—ã€‚</p>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Player</span> {
    <span class="code-function">constructor</span>(x, y) {
        <span class="code-comment">// å„²å­˜ç›®æ¨™ä½ç½®</span>
        <span class="code-keyword">this</span>.targetX = <span class="code-keyword">null</span>;
        <span class="code-keyword">this</span>.targetY = <span class="code-keyword">null</span>;
    }
}

<span class="code-comment">// æ»‘é¼ ç§»å‹•äº‹ä»¶</span>
canvas.<span class="code-function">addEventListener</span>(<span class="code-string">'mousemove'</span>, (e) =&gt; {
    <span class="code-keyword">const</span> rect = canvas.<span class="code-function">getBoundingClientRect</span>();

    <span class="code-comment">// è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹ï¼ˆCanvas å¯¦éš›å°ºå¯¸ vs é¡¯ç¤ºå°ºå¯¸ï¼‰</span>
    <span class="code-keyword">const</span> scaleX = canvas.width / rect.width;
    <span class="code-keyword">const</span> scaleY = canvas.height / rect.height;

    <span class="code-comment">// è½‰æ›æ»‘é¼ åº§æ¨™åˆ° Canvas åº§æ¨™</span>
    player.targetX = (e.clientX - rect.left) * scaleX;
    player.targetY = (e.clientY - rect.top) * scaleY;
});

<span class="code-comment">// è§¸æ§ç§»å‹•äº‹ä»¶</span>
canvas.<span class="code-function">addEventListener</span>(<span class="code-string">'touchmove'</span>, (e) =&gt; {
    e.<span class="code-function">preventDefault</span>();  <span class="code-comment">// é˜²æ­¢é é¢æ»¾å‹•</span>
    <span class="code-keyword">const</span> rect = canvas.<span class="code-function">getBoundingClientRect</span>();
    <span class="code-keyword">const</span> touch = e.touches[<span class="code-number">0</span>];

    player.targetX = (touch.clientX - rect.left) * scaleX;
    player.targetY = (touch.clientY - rect.top) * scaleY;
}, {passive: <span class="code-keyword">false</span>});</pre>
            </div>

            <div class="code-block">
<pre><span class="code-comment">// åœ¨ update() ä¸­è™•ç†æ»‘é¼ /è§¸æ§ç§»å‹•</span>
<span class="code-function">update</span>() {
    <span class="code-keyword">let</span> dx = <span class="code-number">0</span>, dy = <span class="code-number">0</span>;

    <span class="code-comment">// å¦‚æœæœ‰ç›®æ¨™ä½ç½®ï¼ˆæ»‘é¼ /è§¸æ§ï¼‰</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.targetX !== <span class="code-keyword">null</span> && <span class="code-keyword">this</span>.targetY !== <span class="code-keyword">null</span>) {
        <span class="code-comment">// è¨ˆç®—åˆ°ç›®æ¨™çš„è·é›¢</span>
        <span class="code-keyword">const</span> distX = <span class="code-keyword">this</span>.targetX - <span class="code-keyword">this</span>.x;
        <span class="code-keyword">const</span> distY = <span class="code-keyword">this</span>.targetY - <span class="code-keyword">this</span>.y;
        <span class="code-keyword">const</span> distance = Math.<span class="code-function">sqrt</span>(distX * distX + distY * distY);

        <span class="code-keyword">if</span> (distance &gt; <span class="code-number">5</span>) {  <span class="code-comment">// é¿å…æŠ–å‹•ï¼ˆå¤ªæ¥è¿‘ç›®æ¨™å°±åœæ­¢ï¼‰</span>
            <span class="code-comment">// æ­£è¦åŒ–æ–¹å‘å‘é‡</span>
            dx = distX / distance;
            dy = distY / distance;
        }
    }

    <span class="code-comment">// å¾ŒçºŒç§»å‹•é‚è¼¯åŒéµç›¤æ§åˆ¶...</span>
}</pre>
            </div>
        </section>

        <!-- ç¬¬å››ç« ï¼šè¨ˆæ™‚èˆ‡è¨ˆåˆ†é‚è¼¯ -->
        <section class="section" id="section4">
            <h2>4. è¨ˆæ™‚èˆ‡è¨ˆåˆ†é‚è¼¯</h2>

            <p>éŠæˆ²çš„æ ¸å¿ƒç›®æ¨™æ˜¯ã€Œå­˜æ´»æŒ‡å®šæ™‚é–“ã€ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦å¯¦ä½œè¨ˆæ™‚ç³»çµ±å’Œç”Ÿå‘½å€¼ç³»çµ±ã€‚</p>

            <h3>æ­¥é©Ÿ 1ï¼šå»ºç«‹è¨ˆæ™‚ç³»çµ±</h3>
            <p>ä½¿ç”¨ JavaScript çš„ Date.now() è¿½è¹¤éŠæˆ²æ™‚é–“ã€‚</p>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Game</span> {
    <span class="code-function">constructor</span>() {
        <span class="code-comment">// è¨˜éŒ„éŠæˆ²é–‹å§‹æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰</span>
        <span class="code-keyword">this</span>.startTime = Date.<span class="code-function">now</span>();

        <span class="code-comment">// ç•¶å‰ç¶“éæ™‚é–“ï¼ˆç§’ï¼‰</span>
        <span class="code-keyword">this</span>.elapsedTime = <span class="code-number">0</span>;
    }

    <span class="code-function">update</span>() {
        <span class="code-comment">// è¨ˆç®—ç¶“éæ™‚é–“ï¼ˆè½‰æ›ç‚ºç§’ï¼‰</span>
        <span class="code-keyword">this</span>.elapsedTime = (Date.<span class="code-function">now</span>() - <span class="code-keyword">this</span>.startTime) / <span class="code-number">1000</span>;

        <span class="code-comment">// æª¢æŸ¥æ˜¯å¦é”åˆ°å‹åˆ©æ¢ä»¶ï¼ˆ3 åˆ†é˜ = 180 ç§’ï¼‰</span>
        <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.elapsedTime &gt;= <span class="code-number">180</span>) {
            <span class="code-keyword">this</span>.<span class="code-function">winGame</span>();
        }

        <span class="code-comment">// æ›´æ–° UI é¡¯ç¤º</span>
        <span class="code-keyword">this</span>.<span class="code-function">updateUI</span>();
    }

    <span class="code-function">updateUI</span>() {
        <span class="code-comment">// é¡¯ç¤ºæ™‚é–“ï¼ˆä¿ç•™ä¸€ä½å°æ•¸ï¼‰</span>
        document.<span class="code-function">getElementById</span>(<span class="code-string">'timeCount'</span>).textContent =
            <span class="code-keyword">this</span>.elapsedTime.<span class="code-function">toFixed</span>(<span class="code-number">1</span>);
    }
}</pre>
            </div>

            <div class="highlight-box">
                <h4>ğŸ’¡ ç‚ºä»€éº¼ä½¿ç”¨ Date.now()ï¼Ÿ</h4>
                <ul>
                    <li><strong>æº–ç¢ºæ€§</strong>ï¼šåŸºæ–¼ç³»çµ±æ™‚é–“ï¼Œä¸å—å¹€ç‡å½±éŸ¿</li>
                    <li><strong>ç°¡å–®æ€§</strong>ï¼šåªéœ€è¨˜éŒ„é–‹å§‹æ™‚é–“ï¼Œæ¯æ¬¡æ›´æ–°æ™‚è¨ˆç®—å·®å€¼</li>
                    <li><strong>æš«åœæ”¯æ´</strong>ï¼šæš«åœæ™‚åœæ­¢è¨ˆç®—ï¼Œæ¢å¾©æ™‚èª¿æ•´ startTime</li>
                </ul>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šç”Ÿå‘½å€¼ç³»çµ±</h3>
            <p>ç©å®¶æœ‰ 3 æ¢ç”Ÿå‘½ï¼Œè¢«æŠ“åˆ°å°±æ¸›å°‘ 1 æ¢ï¼Œæ­¸é›¶å‰‡éŠæˆ²çµæŸã€‚</p>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Player</span> {
    <span class="code-function">constructor</span>(x, y) {
        <span class="code-comment">// åˆå§‹ç”Ÿå‘½å€¼</span>
        <span class="code-keyword">this</span>.lives = CONFIG.INITIAL_LIVES;  <span class="code-comment">// 3</span>

        <span class="code-comment">// ç„¡æ•µç‹€æ…‹ï¼ˆè¢«æŠ“åˆ°å¾ŒçŸ­æš«ç„¡æ•µï¼‰</span>
        <span class="code-keyword">this</span>.invincible = <span class="code-keyword">false</span>;
        <span class="code-keyword">this</span>.invincibleTimer = <span class="code-number">0</span>;
    }

    <span class="code-comment">/**
     * ç©å®¶è¢«æ“Šä¸­
     * @returns {boolean} - æ˜¯å¦çœŸçš„æ‰£è¡€ï¼ˆç„¡æ•µç‹€æ…‹ä¸‹ä¸æ‰£ï¼‰
     */</span>
    <span class="code-function">hit</span>() {
        <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.invincible) {
            <span class="code-comment">// æ‰£é™¤ç”Ÿå‘½å€¼</span>
            <span class="code-keyword">this</span>.lives--;

            <span class="code-comment">// å•Ÿå‹•ç„¡æ•µç‹€æ…‹ï¼ˆ2 ç§’ï¼‰</span>
            <span class="code-keyword">this</span>.invincible = <span class="code-keyword">true</span>;
            <span class="code-comment">// è½‰æ›ç‚ºå¹€æ•¸ï¼ˆå‡è¨­ 60 FPSï¼‰</span>
            <span class="code-keyword">this</span>.invincibleTimer = CONFIG.INVINCIBLE_TIME / (<span class="code-number">1000</span> / <span class="code-number">60</span>);

            <span class="code-comment">// é‡ç”Ÿåˆ°èµ·å§‹ä½ç½®</span>
            <span class="code-keyword">this</span>.<span class="code-function">respawn</span>();

            <span class="code-keyword">return</span> <span class="code-keyword">true</span>;  <span class="code-comment">// ç¢ºå¯¦æ‰£è¡€</span>
        }
        <span class="code-keyword">return</span> <span class="code-keyword">false</span>;  <span class="code-comment">// ç„¡æ•µç‹€æ…‹ï¼Œæ²’æœ‰æ‰£è¡€</span>
    }

    <span class="code-function">update</span>() {
        <span class="code-comment">// æ›´æ–°ç„¡æ•µç‹€æ…‹</span>
        <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.invincible) {
            <span class="code-keyword">this</span>.invincibleTimer--;
            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.invincibleTimer &lt;= <span class="code-number">0</span>) {
                <span class="code-keyword">this</span>.invincible = <span class="code-keyword">false</span>;
            }
        }
    }

    <span class="code-function">respawn</span>() {
        <span class="code-comment">// é‡ç”Ÿåˆ°èµ·å§‹ä½ç½®</span>
        <span class="code-keyword">this</span>.x = PLAYER_START.x;
        <span class="code-keyword">this</span>.y = PLAYER_START.y;
    }
}</pre>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šç„¡æ•µé–ƒçˆæ•ˆæœ</h3>
            <p>åœ¨ç¹ªè£½æ™‚åŠ å…¥é–ƒçˆæ•ˆæœï¼Œè®“ç©å®¶çŸ¥é“è‡ªå·±è™•æ–¼ç„¡æ•µç‹€æ…‹ã€‚</p>

            <div class="code-block">
<pre><span class="code-function">draw</span>(ctx) {
    <span class="code-comment">// ç„¡æ•µç‹€æ…‹ä¸‹çš„é–ƒçˆæ•ˆæœ</span>
    <span class="code-comment">// æ¯ 5 å¹€åˆ‡æ›ä¸€æ¬¡é¡¯ç¤º/éš±è—</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.invincible && Math.<span class="code-function">floor</span>(<span class="code-keyword">this</span>.invincibleTimer / <span class="code-number">5</span>) % <span class="code-number">2</span> === <span class="code-number">0</span>) {
        <span class="code-keyword">return</span>;  <span class="code-comment">// é€™ä¸€å¹€ä¸ç¹ªè£½ï¼ˆç”¢ç”Ÿé–ƒçˆæ•ˆæœï¼‰</span>
    }

    <span class="code-comment">// ç¹ªè£½ç©å®¶åœ“å½¢</span>
    ctx.fillStyle = CONFIG.PLAYER_COLOR;
    ctx.<span class="code-function">beginPath</span>();
    ctx.<span class="code-function">arc</span>(<span class="code-keyword">this</span>.x, <span class="code-keyword">this</span>.y, <span class="code-keyword">this</span>.radius, <span class="code-number">0</span>, Math.PI * <span class="code-number">2</span>);
    ctx.<span class="code-function">fill</span>();
}</pre>
            </div>

            <h3>æ­¥é©Ÿ 4ï¼šUI é¡¯ç¤ºç”Ÿå‘½å€¼</h3>
            <p>ä½¿ç”¨é‡‘éŒ¢ç¬¦è™Ÿ ğŸ’° é¡¯ç¤ºå‰©é¤˜ç”Ÿå‘½å€¼ã€‚</p>

            <div class="code-block">
<pre><span class="code-function">updateUI</span>() {
    <span class="code-comment">// æ›´æ–°ç”Ÿå‘½å€¼é¡¯ç¤º</span>
    <span class="code-keyword">const</span> livesCount = document.<span class="code-function">getElementById</span>(<span class="code-string">'livesCount'</span>);
    livesCount.innerHTML = <span class="code-string">''</span>;

    <span class="code-comment">// æ ¹æ“šå‰©é¤˜ç”Ÿå‘½å€¼é¡¯ç¤ºé‡‘éŒ¢ç¬¦è™Ÿ</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">let</span> i = <span class="code-number">0</span>; i &lt; <span class="code-keyword">this</span>.player.lives; i++) {
        livesCount.innerHTML += <span class="code-string">'&lt;span class="money"&gt;ğŸ’°&lt;/span&gt;'</span>;
    }
}</pre>
            </div>

            <div class="demo-box">
                <h4>ğŸ® è¨ˆåˆ†èˆ‡è¨ˆæ™‚å±•ç¤º</h4>
                <div style="background: #2e3933; padding: 20px; border-radius: 10px; color: white;">
                    <div style="display: flex; justify-content: space-around; font-size: 20px;">
                        <div>
                            <strong>å‰©é¤˜ç”Ÿå‘½ï¼š</strong>
                            <span>ğŸ’°ğŸ’°ğŸ’°</span>
                        </div>
                        <div>
                            <strong>æ™‚é–“ï¼š</strong>
                            <span id="demoTime">0.0</span> ç§’
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç¬¬äº”ç« ï¼šæ•µäºº AI èˆ‡è¦–ç·šç³»çµ± -->
        <section class="section" id="section5">
            <h2>5. æ•µäºº AI èˆ‡è¦–ç·šç³»çµ±</h2>

            <p>æ•µäººæ“æœ‰å…©ç¨®è¡Œç‚ºæ¨¡å¼ï¼šå·¡é‚æ¨¡å¼å’Œè¿½æ“Šæ¨¡å¼ã€‚ç•¶æ•µäººçœ‹åˆ°ç©å®¶æ™‚æœƒåˆ‡æ›åˆ°è¿½æ“Šæ¨¡å¼ã€‚</p>

            <h3>æ­¥é©Ÿ 1ï¼šè¦–ç·šæª¢æ¸¬ç³»çµ±</h3>
            <p>ä½¿ç”¨å°„ç·šèˆ‡çŸ©å½¢ç›¸äº¤æ¼”ç®—æ³•ï¼Œåˆ¤æ–·æ•µäººèˆ‡ç©å®¶ä¹‹é–“æ˜¯å¦æœ‰ç‰†é˜»æ“‹è¦–ç·šã€‚</p>

            <div class="code-block">
<pre><span class="code-comment">/**
 * æª¢æŸ¥å…©é»ä¹‹é–“æ˜¯å¦æœ‰ç‰†é˜»æ“‹è¦–ç·š
 * @param {number} x1, y1 - èµ·é»åº§æ¨™ï¼ˆæ•µäººä½ç½®ï¼‰
 * @param {number} x2, y2 - çµ‚é»åº§æ¨™ï¼ˆç©å®¶ä½ç½®ï¼‰
 * @returns {boolean} - æ˜¯å¦æœ‰è¦–ç·šï¼ˆç„¡ç‰†é˜»æ“‹ï¼‰
 */</span>
<span class="code-keyword">function</span> <span class="code-function">hasLineOfSight</span>(x1, y1, x2, y2) {
    <span class="code-comment">// æª¢æŸ¥å°„ç·šæ˜¯å¦èˆ‡ä»»ä½•ç‰†é«”ç›¸äº¤</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">let</span> wall <span class="code-keyword">of</span> WALLS) {
        <span class="code-keyword">if</span> (<span class="code-function">lineRectIntersection</span>(x1, y1, x2, y2, wall)) {
            <span class="code-keyword">return</span> <span class="code-keyword">false</span>;  <span class="code-comment">// æœ‰ç‰†é˜»æ“‹</span>
        }
    }
    <span class="code-keyword">return</span> <span class="code-keyword">true</span>;  <span class="code-comment">// æ²’æœ‰é˜»æ“‹ï¼Œè¦–ç·šæš¢é€š</span>
}

<span class="code-comment">/**
 * å°„ç·šèˆ‡çŸ©å½¢ç›¸äº¤æª¢æ¸¬ï¼ˆLiang-Barsky æ¼”ç®—æ³•ï¼‰
 */</span>
<span class="code-keyword">function</span> <span class="code-function">lineRectIntersection</span>(x1, y1, x2, y2, rect) {
    <span class="code-keyword">const</span> dx = x2 - x1;
    <span class="code-keyword">const</span> dy = y2 - y1;

    <span class="code-comment">// Liang-Barsky æ¼”ç®—æ³•çš„åƒæ•¸</span>
    <span class="code-keyword">let</span> t0 = <span class="code-number">0</span>, t1 = <span class="code-number">1</span>;
    <span class="code-keyword">const</span> p = [-dx, dx, -dy, dy];
    <span class="code-keyword">const</span> q = [
        x1 - rect.x,
        rect.x + rect.width - x1,
        y1 - rect.y,
        rect.y + rect.height - y1
    ];

    <span class="code-keyword">for</span> (<span class="code-keyword">let</span> i = <span class="code-number">0</span>; i &lt; <span class="code-number">4</span>; i++) {
        <span class="code-keyword">if</span> (p[i] === <span class="code-number">0</span>) {
            <span class="code-keyword">if</span> (q[i] &lt; <span class="code-number">0</span>) <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
        } <span class="code-keyword">else</span> {
            <span class="code-keyword">const</span> t = q[i] / p[i];
            <span class="code-keyword">if</span> (p[i] &lt; <span class="code-number">0</span>) {
                <span class="code-keyword">if</span> (t &gt; t1) <span class="code-keyword">return</span> <span class="code-keyword">false</span>;
                <span class="code-keyword">if</span> (t &gt; t0) t0 = t;
            } <span class="code-keyword">else</span> {
                <span class="code-keyword">if</span> (t &lt; t0) <span class="code-keyword">return</span> <span class="code-keyword">false</span>;
                <span class="code-keyword">if</span> (t &lt; t1) t1 = t;
            }
        }
    }

    <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}</pre>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šæ•µäºº AI é‚è¼¯</h3>
            <p>æ•µäººæ ¹æ“šè¦–ç·šæª¢æ¸¬çµæœï¼Œåœ¨å·¡é‚å’Œè¿½æ“Šæ¨¡å¼ä¹‹é–“åˆ‡æ›ã€‚</p>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Enemy</span> {
    <span class="code-function">constructor</span>(x, y) {
        <span class="code-keyword">this</span>.x = x;
        <span class="code-keyword">this</span>.y = y;
        <span class="code-keyword">this</span>.speed = CONFIG.ENEMY_SPEED;
        <span class="code-keyword">this</span>.isChasing = <span class="code-keyword">false</span>;  <span class="code-comment">// æ˜¯å¦æ­£åœ¨è¿½æ“Š</span>

        <span class="code-comment">// å·¡é‚æ¨¡å¼çš„éš¨æ©Ÿç§»å‹•</span>
        <span class="code-keyword">this</span>.direction = Math.<span class="code-function">random</span>() * Math.PI * <span class="code-number">2</span>;  <span class="code-comment">// éš¨æ©Ÿæ–¹å‘</span>
        <span class="code-keyword">this</span>.changeDirectionTimer = <span class="code-number">0</span>;
        <span class="code-keyword">this</span>.changeDirectionInterval = <span class="code-number">60</span>;  <span class="code-comment">// æ¯ 60 å¹€æ”¹è®Šæ–¹å‘</span>
    }

    <span class="code-function">update</span>(player) {
        <span class="code-comment">// æ­¥é©Ÿ 1ï¼šæª¢æŸ¥æ˜¯å¦çœ‹åˆ°ç©å®¶</span>
        <span class="code-keyword">const</span> dx = player.x - <span class="code-keyword">this</span>.x;
        <span class="code-keyword">const</span> dy = player.y - <span class="code-keyword">this</span>.y;
        <span class="code-keyword">const</span> distance = Math.<span class="code-function">sqrt</span>(dx * dx + dy * dy);

        <span class="code-keyword">this</span>.isChasing = <span class="code-keyword">false</span>;

        <span class="code-comment">// æª¢æŸ¥è·é›¢å’Œè¦–ç·šï¼ˆç©å®¶ç„¡æ•µæ™‚ä¸è¿½è¹¤ï¼‰</span>
        <span class="code-keyword">if</span> (!player.invincible && distance &lt;= CONFIG.ENEMY_VISION_RANGE) {
            <span class="code-keyword">if</span> (<span class="code-function">hasLineOfSight</span>(<span class="code-keyword">this</span>.x, <span class="code-keyword">this</span>.y, player.x, player.y)) {
                <span class="code-keyword">this</span>.isChasing = <span class="code-keyword">true</span>;  <span class="code-comment">// åˆ‡æ›åˆ°è¿½æ“Šæ¨¡å¼</span>
            }
        }

        <span class="code-keyword">let</span> moveX, moveY;

        <span class="code-comment">// æ­¥é©Ÿ 2ï¼šæ ¹æ“šæ¨¡å¼æ±ºå®šç§»å‹•æ–¹å‘</span>
        <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.isChasing) {
            <span class="code-comment">// è¿½æ“Šæ¨¡å¼ï¼šç›´æ¥æœç©å®¶ç§»å‹•</span>
            <span class="code-keyword">const</span> chaseSpeed = CONFIG.ENEMY_CHASE_SPEED;
            moveX = (dx / distance) * chaseSpeed;
            moveY = (dy / distance) * chaseSpeed;
        } <span class="code-keyword">else</span> {
            <span class="code-comment">// å·¡é‚æ¨¡å¼ï¼šéš¨æ©Ÿç§»å‹•</span>
            <span class="code-keyword">this</span>.changeDirectionTimer++;
            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.changeDirectionTimer &gt;= <span class="code-keyword">this</span>.changeDirectionInterval) {
                <span class="code-comment">// å®šæœŸæ”¹è®Šæ–¹å‘</span>
                <span class="code-keyword">this</span>.direction = Math.<span class="code-function">random</span>() * Math.PI * <span class="code-number">2</span>;
                <span class="code-keyword">this</span>.changeDirectionTimer = <span class="code-number">0</span>;
            }

            moveX = Math.<span class="code-function">cos</span>(<span class="code-keyword">this</span>.direction) * <span class="code-keyword">this</span>.speed;
            moveY = Math.<span class="code-function">sin</span>(<span class="code-keyword">this</span>.direction) * <span class="code-keyword">this</span>.speed;
        }

        <span class="code-comment">// æ­¥é©Ÿ 3ï¼šç¢°æ’æª¢æ¸¬ä¸¦ç§»å‹•</span>
        <span class="code-keyword">const</span> newX = <span class="code-keyword">this</span>.x + moveX;
        <span class="code-keyword">const</span> newY = <span class="code-keyword">this</span>.y + moveY;

        <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.<span class="code-function">checkCollision</span>(newX, <span class="code-keyword">this</span>.y)) {
            <span class="code-keyword">this</span>.x = newX;
        } <span class="code-keyword">else</span> {
            <span class="code-comment">// ç¢°åˆ°ç‰†ï¼Œæ”¹è®Šæ–¹å‘</span>
            <span class="code-keyword">this</span>.direction = Math.<span class="code-function">random</span>() * Math.PI * <span class="code-number">2</span>;
        }

        <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.<span class="code-function">checkCollision</span>(<span class="code-keyword">this</span>.x, newY)) {
            <span class="code-keyword">this</span>.y = newY;
        } <span class="code-keyword">else</span> {
            <span class="code-keyword">this</span>.direction = Math.<span class="code-function">random</span>() * Math.PI * <span class="code-number">2</span>;
        }
    }
}</pre>
            </div>

            <div class="highlight-box">
                <h4>ğŸ’¡ AI è¨­è¨ˆé‡é»</h4>
                <ul>
                    <li><strong>è¦–ç·šç¯„åœé™åˆ¶</strong>ï¼šåªåœ¨ä¸€å®šè·é›¢å…§è¿½è¹¤ç©å®¶ï¼Œé¿å…æ•µäººéæ–¼å¼·å¤§</li>
                    <li><strong>è¦–ç·šé˜»æ“‹</strong>ï¼šç‰†å£æœƒé˜»æ“‹è¦–ç·šï¼Œç©å®¶å¯ä»¥èº²åœ¨ç‰†å¾Œ</li>
                    <li><strong>ç„¡æ•µå¿½ç•¥</strong>ï¼šç©å®¶ç„¡æ•µæ™‚ä¸è¿½è¹¤ï¼Œé¿å…æŒçºŒé¨·æ“¾</li>
                    <li><strong>å·¡é‚æ¨¡å¼</strong>ï¼šæ²’çœ‹åˆ°ç©å®¶æ™‚éš¨æ©Ÿç§»å‹•ï¼Œä¿æŒå¨è„…æ„Ÿ</li>
                </ul>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šç¹ªè£½è¦–ç·šæŒ‡ç¤º</h3>
            <p>è¿½æ“Šæ™‚ç¹ªè£½ä¸€æ¢ç·šï¼Œè®“ç©å®¶æ¸…æ¥šçŸ¥é“æ•µäººæ­£åœ¨è¿½è¹¤ã€‚</p>

            <div class="code-block">
<pre><span class="code-function">draw</span>(ctx) {
    <span class="code-comment">// ç¹ªè£½æ•µäººåœ“å½¢</span>
    ctx.fillStyle = <span class="code-keyword">this</span>.isChasing ?
        CONFIG.ENEMY_CHASE_COLOR : CONFIG.ENEMY_COLOR;
    ctx.<span class="code-function">beginPath</span>();
    ctx.<span class="code-function">arc</span>(<span class="code-keyword">this</span>.x, <span class="code-keyword">this</span>.y, <span class="code-keyword">this</span>.radius, <span class="code-number">0</span>, Math.PI * <span class="code-number">2</span>);
    ctx.<span class="code-function">fill</span>();

    <span class="code-comment">// è¿½æ“Šæ™‚ç¹ªè£½è¦–ç·š</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.isChasing) {
        ctx.strokeStyle = <span class="code-string">'rgba(195, 78, 23, 0.4)'</span>;  <span class="code-comment">// åŠé€æ˜æ©˜è‰²</span>
        ctx.lineWidth = <span class="code-number">2</span>;
        ctx.<span class="code-function">beginPath</span>();
        ctx.<span class="code-function">moveTo</span>(<span class="code-keyword">this</span>.x, <span class="code-keyword">this</span>.y);
        ctx.<span class="code-function">lineTo</span>(player.x, player.y);
        ctx.<span class="code-function">stroke</span>();
    }
}</pre>
            </div>
        </section>

        <!-- ç¬¬å…­ç« ï¼šéŠæˆ²ç‹€æ…‹ç®¡ç† -->
        <section class="section" id="section6">
            <h2>6. éŠæˆ²ç‹€æ…‹ç®¡ç†</h2>

            <p>éŠæˆ²æœ‰å¤šå€‹ç‹€æ…‹ï¼šé–‹å§‹ç•«é¢ã€éŠæˆ²é€²è¡Œä¸­ã€éŠæˆ²çµæŸã€éŠæˆ²å‹åˆ©ã€‚æˆ‘å€‘éœ€è¦ç®¡ç†é€™äº›ç‹€æ…‹ä¹‹é–“çš„åˆ‡æ›ã€‚</p>

            <h3>æ­¥é©Ÿ 1ï¼šå®šç¾©éŠæˆ²ç‹€æ…‹</h3>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Game</span> {
    <span class="code-function">constructor</span>() {
        <span class="code-comment">// éŠæˆ²ç‹€æ…‹æ¨™è¨˜</span>
        <span class="code-keyword">this</span>.gameStarted = <span class="code-keyword">false</span>;  <span class="code-comment">// æ˜¯å¦é–‹å§‹éŠæˆ²</span>
        <span class="code-keyword">this</span>.gameOver = <span class="code-keyword">false</span>;     <span class="code-comment">// æ˜¯å¦éŠæˆ²çµæŸ</span>
    }

    <span class="code-comment">// é–‹å§‹éŠæˆ²</span>
    <span class="code-function">startGame</span>() {
        document.<span class="code-function">getElementById</span>(<span class="code-string">'startScreen'</span>).classList.<span class="code-function">add</span>(<span class="code-string">'hide'</span>);
        <span class="code-keyword">this</span>.gameStarted = <span class="code-keyword">true</span>;
        <span class="code-keyword">this</span>.startTime = Date.<span class="code-function">now</span>();
    }

    <span class="code-comment">// éŠæˆ²å¤±æ•—</span>
    <span class="code-function">endGame</span>() {
        <span class="code-keyword">this</span>.gameOver = <span class="code-keyword">true</span>;
        document.<span class="code-function">getElementById</span>(<span class="code-string">'finalTime'</span>).textContent =
            <span class="code-keyword">this</span>.elapsedTime.<span class="code-function">toFixed</span>(<span class="code-number">1</span>);
        document.<span class="code-function">getElementById</span>(<span class="code-string">'gameOver'</span>).classList.<span class="code-function">add</span>(<span class="code-string">'show'</span>);
    }

    <span class="code-comment">// éŠæˆ²å‹åˆ©</span>
    <span class="code-function">winGame</span>() {
        <span class="code-keyword">this</span>.gameOver = <span class="code-keyword">true</span>;
        document.<span class="code-function">getElementById</span>(<span class="code-string">'winTime'</span>).textContent =
            <span class="code-keyword">this</span>.elapsedTime.<span class="code-function">toFixed</span>(<span class="code-number">1</span>);
        document.<span class="code-function">getElementById</span>(<span class="code-string">'winScreen'</span>).classList.<span class="code-function">add</span>(<span class="code-string">'show'</span>);
    }

    <span class="code-comment">// é‡æ–°é–‹å§‹</span>
    <span class="code-function">restart</span>() {
        <span class="code-comment">// éš±è—æ‰€æœ‰ç•«é¢</span>
        document.<span class="code-function">getElementById</span>(<span class="code-string">'gameOver'</span>).classList.<span class="code-function">remove</span>(<span class="code-string">'show'</span>);
        document.<span class="code-function">getElementById</span>(<span class="code-string">'winScreen'</span>).classList.<span class="code-function">remove</span>(<span class="code-string">'show'</span>);

        <span class="code-comment">// é‡ç½®éŠæˆ²ç‰©ä»¶</span>
        <span class="code-keyword">this</span>.player = <span class="code-keyword">new</span> <span class="code-function">Player</span>(PLAYER_START.x, PLAYER_START.y);
        <span class="code-keyword">this</span>.enemy = <span class="code-keyword">new</span> <span class="code-function">Enemy</span>(ENEMY_START.x, ENEMY_START.y);
        <span class="code-keyword">this</span>.gameOver = <span class="code-keyword">false</span>;
        <span class="code-keyword">this</span>.gameStarted = <span class="code-keyword">true</span>;
        <span class="code-keyword">this</span>.startTime = Date.<span class="code-function">now</span>();
        <span class="code-keyword">this</span>.elapsedTime = <span class="code-number">0</span>;
    }
}</pre>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šæª¢æŸ¥éŠæˆ²ç‹€æ…‹</h3>
            <p>åœ¨éŠæˆ²æ›´æ–°å¾ªç’°ä¸­ï¼Œæª¢æŸ¥ç”Ÿå‘½å€¼å’Œæ™‚é–“ï¼Œè§¸ç™¼ç›¸æ‡‰çš„ç‹€æ…‹åˆ‡æ›ã€‚</p>

            <div class="code-block">
<pre><span class="code-function">update</span>() {
    <span class="code-comment">// éŠæˆ²æœªé–‹å§‹æˆ–å·²çµæŸï¼Œä¸æ›´æ–°</span>
    <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.gameStarted || <span class="code-keyword">this</span>.gameOver) <span class="code-keyword">return</span>;

    <span class="code-comment">// æ›´æ–°éŠæˆ²ç‰©ä»¶</span>
    <span class="code-keyword">this</span>.player.<span class="code-function">update</span>();
    <span class="code-keyword">this</span>.enemy.<span class="code-function">update</span>(<span class="code-keyword">this</span>.player);

    <span class="code-comment">// æª¢æŸ¥ç¢°æ’</span>
    <span class="code-keyword">if</span> (<span class="code-function">circleCircleCollision</span>(
        <span class="code-keyword">this</span>.player.x, <span class="code-keyword">this</span>.player.y, <span class="code-keyword">this</span>.player.radius,
        <span class="code-keyword">this</span>.enemy.x, <span class="code-keyword">this</span>.enemy.y, <span class="code-keyword">this</span>.enemy.radius
    )) {
        <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.player.<span class="code-function">hit</span>()) {
            <span class="code-comment">// é¡¯ç¤ºè¢«æŠ“è¨Šæ¯</span>
            <span class="code-keyword">this</span>.<span class="code-function">showHitMessage</span>();

            <span class="code-comment">// æª¢æŸ¥ç”Ÿå‘½å€¼ï¼Œæ±ºå®šæ˜¯å¦çµæŸéŠæˆ²</span>
            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.player.lives &lt;= <span class="code-number">0</span>) {
                <span class="code-keyword">this</span>.<span class="code-function">endGame</span>();  <span class="code-comment">// éŠæˆ²å¤±æ•—</span>
            }
        }
    }

    <span class="code-comment">// æ›´æ–°è¨ˆæ™‚å™¨</span>
    <span class="code-keyword">this</span>.elapsedTime = (Date.<span class="code-function">now</span>() - <span class="code-keyword">this</span>.startTime) / <span class="code-number">1000</span>;

    <span class="code-comment">// æª¢æŸ¥å‹åˆ©æ¢ä»¶ï¼ˆ180 ç§’ = 3 åˆ†é˜ï¼‰</span>
    <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.elapsedTime &gt;= <span class="code-number">180</span>) {
        <span class="code-keyword">this</span>.<span class="code-function">winGame</span>();  <span class="code-comment">// éŠæˆ²å‹åˆ©</span>
    }

    <span class="code-keyword">this</span>.<span class="code-function">updateUI</span>();
}</pre>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šé¡¯ç¤ºè¢«æŠ“è¨Šæ¯</h3>
            <p>ç•¶ç©å®¶è¢«æŠ“åˆ°æ™‚ï¼ŒçŸ­æš«é¡¯ç¤ºæç¤ºè¨Šæ¯ã€‚</p>

            <div class="code-block">
<pre><span class="code-function">showHitMessage</span>() {
    <span class="code-keyword">const</span> hitMessage = document.<span class="code-function">getElementById</span>(<span class="code-string">'hitMessage'</span>);
    hitMessage.classList.<span class="code-function">add</span>(<span class="code-string">'show'</span>);

    <span class="code-comment">// 1.5 ç§’å¾Œè‡ªå‹•éš±è—</span>
    <span class="code-function">setTimeout</span>(() =&gt; {
        hitMessage.classList.<span class="code-function">remove</span>(<span class="code-string">'show'</span>);
    }, CONFIG.HIT_MESSAGE_TIME);  <span class="code-comment">// 1500 æ¯«ç§’</span>
}</pre>
            </div>

            <div class="info-box">
                <h4>ğŸ¯ ç‹€æ…‹ç®¡ç†è¦é»</h4>
                <ul>
                    <li><strong>æ¸…æ™°çš„ç‹€æ…‹æ¨™è¨˜</strong>ï¼šä½¿ç”¨å¸ƒæ—å€¼æ¨™è¨˜éŠæˆ²ç‹€æ…‹</li>
                    <li><strong>ç‹€æ…‹éš”é›¢</strong>ï¼šéŠæˆ²çµæŸæ™‚åœæ­¢æ›´æ–°é‚è¼¯</li>
                    <li><strong>UI åŒæ­¥</strong>ï¼šç‹€æ…‹è®ŠåŒ–æ™‚åŒæ­¥æ›´æ–°ä»‹é¢</li>
                    <li><strong>å¯é‡ç½®æ€§</strong>ï¼šé‡æ–°é–‹å§‹æ™‚å®Œæ•´é‡ç½®æ‰€æœ‰ç‹€æ…‹</li>
                </ul>
            </div>
        </section>

        <!-- ç¬¬ä¸ƒç« ï¼šå®Œæ•´éŠæˆ²å¾ªç’° -->
        <section class="section" id="section7">
            <h2>7. å®Œæ•´éŠæˆ²å¾ªç’°</h2>

            <p>éŠæˆ²å¾ªç’°æ˜¯æ•´å€‹éŠæˆ²çš„å¿ƒè‡Ÿï¼Œè² è²¬æŒçºŒæ›´æ–°éŠæˆ²ç‹€æ…‹å’Œç¹ªè£½ç•«é¢ã€‚</p>

            <h3>æ­¥é©Ÿ 1ï¼šä½¿ç”¨ requestAnimationFrame</h3>
            <p>requestAnimationFrame æ˜¯ç€è¦½å™¨æä¾›çš„å°ˆé–€ç”¨æ–¼å‹•ç•«çš„ APIï¼Œå®ƒæœƒåœ¨ç€è¦½å™¨æº–å‚™é‡ç¹ªæ™‚å‘¼å«ä½ çš„å‡½æ•¸ã€‚</p>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Game</span> {
    <span class="code-comment">// éŠæˆ²ä¸»å¾ªç’°</span>
    <span class="code-function">gameLoop</span>() {
        <span class="code-comment">// æ­¥é©Ÿ 1ï¼šæ›´æ–°éŠæˆ²é‚è¼¯</span>
        <span class="code-keyword">this</span>.<span class="code-function">update</span>();

        <span class="code-comment">// æ­¥é©Ÿ 2ï¼šç¹ªè£½ç•«é¢</span>
        <span class="code-keyword">this</span>.<span class="code-function">draw</span>();

        <span class="code-comment">// æ­¥é©Ÿ 3ï¼šè«‹æ±‚ä¸‹ä¸€å¹€</span>
        <span class="code-function">requestAnimationFrame</span>(() =&gt; <span class="code-keyword">this</span>.<span class="code-function">gameLoop</span>());
    }

    <span class="code-comment">// å•Ÿå‹•éŠæˆ²</span>
    <span class="code-function">start</span>() {
        <span class="code-keyword">this</span>.<span class="code-function">gameLoop</span>();
    }
}</pre>
            </div>

            <div class="highlight-box">
                <h4>ğŸ’¡ ç‚ºä»€éº¼ä½¿ç”¨ requestAnimationFrameï¼Ÿ</h4>
                <ul>
                    <li><strong>æ•ˆèƒ½å„ªåŒ–</strong>ï¼šè‡ªå‹•èˆ‡è¢å¹•åˆ·æ–°ç‡åŒæ­¥ï¼ˆé€šå¸¸ 60 FPSï¼‰</li>
                    <li><strong>çœé›»</strong>ï¼šé é¢ä¸å¯è¦‹æ™‚è‡ªå‹•æš«åœ</li>
                    <li><strong>æµæš¢åº¦</strong>ï¼šæ¯” setTimeout/setInterval æ›´ç©©å®š</li>
                    <li><strong>æ™‚é–“ç²¾ç¢º</strong>ï¼šæä¾›é«˜ç²¾åº¦æ™‚é–“æˆ³</li>
                </ul>
            </div>

            <h3>æ­¥é©Ÿ 2ï¼šå®Œæ•´çš„éŠæˆ²åˆå§‹åŒ–</h3>

            <div class="code-block">
<pre><span class="code-comment">// ==================== åˆå§‹åŒ–éŠæˆ² ====================</span>
<span class="code-keyword">let</span> game;

window.<span class="code-function">addEventListener</span>(<span class="code-string">'load'</span>, () =&gt; {
    <span class="code-comment">// ç­‰å¾…é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–éŠæˆ²</span>
    game = <span class="code-keyword">new</span> <span class="code-function">Game</span>();
    game.<span class="code-function">start</span>();  <span class="code-comment">// å•Ÿå‹•éŠæˆ²å¾ªç’°</span>
});</pre>
            </div>

            <h3>æ­¥é©Ÿ 3ï¼šå®Œæ•´çš„æ›´æ–°èˆ‡ç¹ªè£½æµç¨‹</h3>

            <div class="code-block">
<pre><span class="code-keyword">class</span> <span class="code-function">Game</span> {
    <span class="code-function">update</span>() {
        <span class="code-comment">// æª¢æŸ¥éŠæˆ²ç‹€æ…‹</span>
        <span class="code-keyword">if</span> (!<span class="code-keyword">this</span>.gameStarted || <span class="code-keyword">this</span>.gameOver) <span class="code-keyword">return</span>;

        <span class="code-comment">// 1. æ›´æ–°ç©å®¶</span>
        <span class="code-keyword">this</span>.player.<span class="code-function">update</span>();

        <span class="code-comment">// 2. æ›´æ–°æ•µäºº</span>
        <span class="code-keyword">this</span>.enemy.<span class="code-function">update</span>(<span class="code-keyword">this</span>.player);

        <span class="code-comment">// 3. æª¢æŸ¥ç¢°æ’</span>
        <span class="code-keyword">if</span> (<span class="code-function">circleCircleCollision</span>(
            <span class="code-keyword">this</span>.player.x, <span class="code-keyword">this</span>.player.y, <span class="code-keyword">this</span>.player.radius,
            <span class="code-keyword">this</span>.enemy.x, <span class="code-keyword">this</span>.enemy.y, <span class="code-keyword">this</span>.enemy.radius
        )) {
            <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.player.<span class="code-function">hit</span>()) {
                <span class="code-keyword">this</span>.<span class="code-function">showHitMessage</span>();
                <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.player.lives &lt;= <span class="code-number">0</span>) {
                    <span class="code-keyword">this</span>.<span class="code-function">endGame</span>();
                }
            }
        }

        <span class="code-comment">// 4. æ›´æ–°è¨ˆæ™‚å™¨</span>
        <span class="code-keyword">this</span>.elapsedTime = (Date.<span class="code-function">now</span>() - <span class="code-keyword">this</span>.startTime) / <span class="code-number">1000</span>;

        <span class="code-comment">// 5. æª¢æŸ¥å‹åˆ©æ¢ä»¶</span>
        <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.elapsedTime &gt;= <span class="code-number">180</span>) {
            <span class="code-keyword">this</span>.<span class="code-function">winGame</span>();
        }

        <span class="code-comment">// 6. æ›´æ–° UI</span>
        <span class="code-keyword">this</span>.<span class="code-function">updateUI</span>();
    }

    <span class="code-function">draw</span>() {
        <span class="code-comment">// 1. æ¸…ç©ºç•«é¢ï¼ˆç¹ªè£½åœ°æ¿ï¼‰</span>
        <span class="code-keyword">this</span>.ctx.fillStyle = CONFIG.FLOOR_COLOR;
        <span class="code-keyword">this</span>.ctx.<span class="code-function">fillRect</span>(<span class="code-number">0</span>, <span class="code-number">0</span>, CONFIG.CANVAS_WIDTH, CONFIG.CANVAS_HEIGHT);

        <span class="code-comment">// 2. ç¹ªè£½ç‰†é«”</span>
        <span class="code-keyword">this</span>.ctx.fillStyle = CONFIG.WALL_COLOR;
        <span class="code-keyword">for</span> (<span class="code-keyword">let</span> wall <span class="code-keyword">of</span> WALLS) {
            <span class="code-keyword">this</span>.ctx.<span class="code-function">fillRect</span>(wall.x, wall.y, wall.width, wall.height);
        }

        <span class="code-comment">// 3. ç¹ªè£½æ•µäºº</span>
        <span class="code-keyword">this</span>.enemy.<span class="code-function">draw</span>(<span class="code-keyword">this</span>.ctx);

        <span class="code-comment">// 4. ç¹ªè£½ç©å®¶</span>
        <span class="code-keyword">this</span>.player.<span class="code-function">draw</span>(<span class="code-keyword">this</span>.ctx);
    }
}</pre>
            </div>

            <div class="demo-box">
                <h4>ğŸ® éŠæˆ²å¾ªç’°æµç¨‹åœ–</h4>
                <div style="background: white; padding: 20px; border-radius: 10px; text-align: left;">
                    <ol class="step-list">
                        <li><strong>åˆå§‹åŒ–</strong>ï¼šè¼‰å…¥éŠæˆ²è³‡æºï¼Œå»ºç«‹éŠæˆ²ç‰©ä»¶</li>
                        <li><strong>æ›´æ–°é‚è¼¯</strong>ï¼šè™•ç†è¼¸å…¥ã€ç§»å‹•ç‰©ä»¶ã€æª¢æ¸¬ç¢°æ’</li>
                        <li><strong>ç¹ªè£½ç•«é¢</strong>ï¼šæ¸…ç©º â†’ ç¹ªè£½èƒŒæ™¯ â†’ ç¹ªè£½ç‰©ä»¶</li>
                        <li><strong>æª¢æŸ¥ç‹€æ…‹</strong>ï¼šåˆ¤æ–·å‹åˆ©/å¤±æ•—æ¢ä»¶</li>
                        <li><strong>è«‹æ±‚ä¸‹ä¸€å¹€</strong>ï¼šä½¿ç”¨ requestAnimationFrame ç¹¼çºŒå¾ªç’°</li>
                    </ol>
                </div>
            </div>

            <h3>å®Œæ•´å°ˆæ¡ˆçµæ§‹</h3>
            <p>æœ€å¾Œï¼Œè®“æˆ‘å€‘ç¸½çµä¸€ä¸‹å®Œæ•´çš„å°ˆæ¡ˆçµæ§‹ï¼š</p>

            <div class="code-block">
<pre><span class="code-comment">// ==================== æª”æ¡ˆçµæ§‹ ====================</span>
game1/
â”œâ”€â”€ game1.html          <span class="code-comment">// HTML é é¢</span>
â”œâ”€â”€ game1.js            <span class="code-comment">// JavaScript éŠæˆ²é‚è¼¯</span>
â””â”€â”€ game1.css           <span class="code-comment">// CSS æ¨£å¼</span>

<span class="code-comment">// ==================== ç¨‹å¼ç¢¼çµæ§‹ ====================</span>
<span class="code-comment">// 1. é…ç½®èˆ‡å¸¸æ•¸</span>
- CONFIG ç‰©ä»¶
- WALLS é™£åˆ—
- èµ·å§‹ä½ç½®

<span class="code-comment">// 2. å·¥å…·å‡½æ•¸</span>
- circleRectCollision()      <span class="code-comment">// åœ“å½¢èˆ‡çŸ©å½¢ç¢°æ’</span>
- circleCircleCollision()    <span class="code-comment">// åœ“å½¢èˆ‡åœ“å½¢ç¢°æ’</span>
- lineRectIntersection()     <span class="code-comment">// å°„ç·šèˆ‡çŸ©å½¢ç›¸äº¤</span>
- hasLineOfSight()           <span class="code-comment">// è¦–ç·šæª¢æ¸¬</span>

<span class="code-comment">// 3. é¡åˆ¥å®šç¾©</span>
- <span class="code-keyword">class</span> Player              <span class="code-comment">// ç©å®¶é¡åˆ¥</span>
  - constructor()
  - update()
  - checkCollision()
  - hit()
  - respawn()
  - draw()

- <span class="code-keyword">class</span> Enemy               <span class="code-comment">// æ•µäººé¡åˆ¥</span>
  - constructor()
  - update()
  - checkCollision()
  - draw()

- <span class="code-keyword">class</span> Game                <span class="code-comment">// éŠæˆ²ä¸»é¡åˆ¥</span>
  - constructor()
  - setupInput()
  - update()
  - draw()
  - updateUI()
  - gameLoop()
  - startGame()
  - endGame()
  - winGame()
  - restart()

<span class="code-comment">// 4. åˆå§‹åŒ–</span>
window.<span class="code-function">addEventListener</span>(<span class="code-string">'load'</span>, () =&gt; {
    game = <span class="code-keyword">new</span> <span class="code-function">Game</span>();
    game.<span class="code-function">start</span>();
});</pre>
            </div>
        </section>

        <!-- çµèª -->
        <footer>
            <h2>ğŸ‰ æ­å–œå®Œæˆæ•™å­¸ï¼</h2>
            <p>ä½ å·²ç¶“å­¸æœƒäº†å¦‚ä½•æ’°å¯«ä¸€å€‹å®Œæ•´çš„ 2D èº²é¿éŠæˆ²ï¼ŒåŒ…å«ï¼š</p>
            <ul style="text-align: left; max-width: 600px; margin: 20px auto;">
                <li>Canvas ç¹ªåœ–èˆ‡åŸºç¤è¨­å®š</li>
                <li>ç¢°æ’æª¢æ¸¬ç³»çµ±ï¼ˆåœ“å½¢èˆ‡çŸ©å½¢ã€åœ“å½¢èˆ‡åœ“å½¢ï¼‰</li>
                <li>å¤šç¨®è¼¸å…¥æ§åˆ¶ï¼ˆéµç›¤ã€æ»‘é¼ ã€è§¸æ§ï¼‰</li>
                <li>è¨ˆæ™‚èˆ‡è¨ˆåˆ†é‚è¼¯</li>
                <li>æ•µäºº AI èˆ‡è¦–ç·šç³»çµ±</li>
                <li>éŠæˆ²ç‹€æ…‹ç®¡ç†</li>
                <li>å®Œæ•´çš„éŠæˆ²å¾ªç’°</li>
            </ul>
            <p style="margin-top: 30px;">ç¾åœ¨ä½ å¯ä»¥åŸºæ–¼é€™äº›çŸ¥è­˜ï¼Œå‰µé€ å±¬æ–¼è‡ªå·±çš„éŠæˆ²ï¼</p>
            <div class="nav-buttons" style="margin-top: 30px;">
                <a href="../index.html" class="nav-btn">å›åˆ°é¦–é </a>
                <a href="../game1/game1.html" class="nav-btn">è©¦ç©éŠæˆ²</a>
            </div>
            <p style="margin-top: 40px; color: #999;">Â© 2025 å„ç‚ºã€Œä¿ä¿ã€ï¼Œä¸Šè»Šå›‰ - ç¨‹å¼æ•™å­¸</p>
        </footer>
    </div>

    <script>
        // Demo 1: åŸºæœ¬ç•«å¸ƒç¹ªè£½
        const demo1Canvas = document.getElementById('demo1');
        const demo1Ctx = demo1Canvas.getContext('2d');

        // ç¹ªè£½åœ°æ¿
        demo1Ctx.fillStyle = '#2e3933';
        demo1Ctx.fillRect(0, 0, 400, 300);

        // ç¹ªè£½ç‰†é«”ï¼ˆç¸®æ”¾ç‰ˆï¼‰
        demo1Ctx.fillStyle = '#d0d4d0';
        const wallsDemo = [
            {x: 0, y: 0, width: 400, height: 10},
            {x: 0, y: 290, width: 400, height: 10},
            {x: 0, y: 0, width: 10, height: 300},
            {x: 390, y: 0, width: 10, height: 300},
            {x: 50, y: 50, width: 75, height: 10},
            {x: 150, y: 100, width: 10, height: 100}
        ];
        wallsDemo.forEach(wall => {
            demo1Ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
        });

        // Demo 2: ç¢°æ’æª¢æ¸¬ç¤ºæ„åœ–
        const demo2Canvas = document.getElementById('demo2');
        const demo2Ctx = demo2Canvas.getContext('2d');
        let demo2X = 100;
        let demo2Y = 150;
        let demo2DX = 2;
        let demo2DY = 1;

        function circleRectCollisionDemo(cx, cy, radius, rect) {
            let testX = cx;
            let testY = cy;

            if (cx < rect.x) testX = rect.x;
            else if (cx > rect.x + rect.width) testX = rect.x + rect.width;

            if (cy < rect.y) testY = rect.y;
            else if (cy > rect.y + rect.height) testY = rect.y + rect.height;

            const distX = cx - testX;
            const distY = cy - testY;
            const distance = Math.sqrt(distX * distX + distY * distY);

            return distance <= radius;
        }

        function animateDemo2() {
            // æ¸…ç©º
            demo2Ctx.fillStyle = '#2e3933';
            demo2Ctx.fillRect(0, 0, 400, 300);

            // ç¹ªè£½çŸ©å½¢
            const rect = {x: 250, y: 100, width: 100, height: 100};
            demo2Ctx.fillStyle = '#d0d4d0';
            demo2Ctx.fillRect(rect.x, rect.y, rect.width, rect.height);

            // ç§»å‹•åœ“å½¢
            demo2X += demo2DX;
            demo2Y += demo2DY;

            // é‚Šç•Œåå½ˆ
            if (demo2X < 20 || demo2X > 380) demo2DX *= -1;
            if (demo2Y < 20 || demo2Y > 280) demo2DY *= -1;

            // æª¢æŸ¥ç¢°æ’
            const isColliding = circleRectCollisionDemo(demo2X, demo2Y, 15, rect);

            // ç¹ªè£½åœ“å½¢ï¼ˆç¢°æ’æ™‚è®Šç´…ï¼‰
            demo2Ctx.fillStyle = isColliding ? '#c34e17' : '#a0c5db';
            demo2Ctx.beginPath();
            demo2Ctx.arc(demo2X, demo2Y, 15, 0, Math.PI * 2);
            demo2Ctx.fill();

            requestAnimationFrame(animateDemo2);
        }

        animateDemo2();

        // Demo è¨ˆæ™‚å™¨
        let demoStartTime = Date.now();
        function updateDemoTime() {
            const elapsed = (Date.now() - demoStartTime) / 1000;
            document.getElementById('demoTime').textContent = elapsed.toFixed(1);
            requestAnimationFrame(updateDemoTime);
        }
        updateDemoTime();
    </script>
</body>
</html>